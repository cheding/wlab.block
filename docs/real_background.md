# Real backgrounds

If you encounter such a problem that fake mutations generated by sequencing cannot be distinguished from real mutations by "fitnessMinInputCountAll", when you use DiMSum to caculate fitness. This pipline may be useful for you.

## Example pipeline

This is a basic example pipeline which shows you how to use real backgrounds to remove fake mutations:

``` r
## basic example code
library(wlab.block)
```

### nicking mutagenesis library

If your libries were generated by nicking mutagenesis, please use this pipeline to identify background mutations in your mutation libraries.

``` r
# set background library pathes
# makesure that each block has at least 3 libraries
input_dir_list<-list(
  "bg1_1"="path/to/bg1_1/",
  "bg2_1"="path/to/bg2_1/",
  "bg1_2"="path/to/bg1_2/",
  "bg2_2"="path/to/bg2_2/",
  "tgt_1"="path/to/tgt_1/",
  "tgt_2"="path/to/tgt_1/"
)
# set target library pathes
input_files_thre<-list(
  "tgt_1"="path/to/tgt_1/",
  "tgt_2"="path/to/tgt_1/"
)
# generate library backgrounds
rbg_nick_library(input_dir_list,output_dir="./",block=c('1','2'))
```
The above steps will generate a distribution map of background mutations, which can help you determine some parameters for setting the background.
``` r
rbg_nick_library_thresholds(
    input_files_thre,
    input_dir="./",
    output_dir = NULL,
    block=c('1'),
    min_obs=200,
    min_phenotypes=2
)
```
This step will output mutation data through the background and save it in the corresponding named "variantCounts. tsv" file.
### synthetic library

If your libries are synthetic, please use this pipeline to identify background mutations in your mutation libraries.

``` r
# set the position of the artificially background
position<-list(
  "tgt_1"="bg_location_1",
  "tgt_2"="bg_location_2"
)

rbg_synthetic_library(
    input_files_thre,
    output_dir="./",
    position,
    codon="NNK"
)
```
Same to nicking mutagenesis library, this step will output the corresponding named "variantCounts. tsv" file.
### supplementary functions

If you are interested in how this pipeline distinguish mutations , the following function can draw relevant diagrams.

``` r
rbg_density_plot("./")
```
